<div class="wrapper">
  <app-navigation />
  <div class="station_content">
    <div class="add_station">
      <div class="map">
        <google-map
          width="100%"
          height="100%"
          [options]="options"
          (mapClick)="moveMap($event)"
        >
          @if (userMark.show) {
            <map-advanced-marker
              #marker="mapAdvancedMarker"
              [position]="{ lat: userMark.lat, lng: userMark.lng }"
            />
          }
          @for (location of nzLocations; track location) {
            <map-advanced-marker
              #marker="mapAdvancedMarker"
              [position]="{ lat: location.lat, lng: location.lng }"
              [title]="location.city"
              (mapClick)="window.open(marker)"
            />
            <map-info-window #window="mapInfoWindow">{{
              location.city
            }}</map-info-window>
          }
        </google-map>
      </div>
      <form [formGroup]="form" class="form" (submit)="handleSubmit()">
        <div class="form__line">
          <label for="cityName" class="line__label">City Name</label>
          <input
            type="text"
            id="cityName"
            class="line__input"
            formControlName="cityName"
            (input)="changeCityName()"
          />
          <div
            class="line"
            [ngClass]="{
              valid:
                form.controls.cityName.valid && form.controls.cityName.touched,
              invalid:
                form.controls.cityName.invalid &&
                form.controls.cityName.touched,
            }"
          ></div>
          @if (form.controls['cityName'].value?.length === 0) {
            <div class="start">Please enter a city name</div>
          }
        </div>
        <div class="form__line">
          <label for="latitude" class="line__label">Latitude</label>
          <input
            type="number"
            id="latitude"
            class="line__input"
            formControlName="latitude"
            [value]="latitudeUser"
            (input)="changeLatitude()"
          />
          <div
            class="line"
            [ngClass]="{
              valid:
                form.controls.latitude.valid && form.controls.latitude.touched,
              invalid:
                form.controls.latitude.invalid &&
                form.controls.latitude.touched,
            }"
          ></div>
          @if (form.controls['latitude'].value?.length === 0) {
            <div class="start">Please enter a latitude</div>
          }
          @if (form.controls['latitude'].errors?.['latitudeNumberValidator']) {
            <div class="alert">Enter a number between -90 and 90</div>
          }
        </div>
        <div class="form__line">
          <label for="longitude" class="line__label">Longitude</label>
          <input
            type="number"
            id="longitude"
            class="line__input"
            formControlName="longitude"
            [value]="longitudeUser"
            (input)="changeLongitude()"
          />
          <div
            class="line"
            [ngClass]="{
              valid:
                form.controls.longitude.valid &&
                form.controls.longitude.touched,
              invalid:
                form.controls.longitude.invalid &&
                form.controls.longitude.touched,
            }"
          ></div>
          @if (form.controls['longitude'].value?.length === 0) {
            <div class="start">Please enter a longitude</div>
          }
          @if (
            form.controls['longitude'].errors?.['longitudeNumberValidator']
          ) {
            <div class="alert">Enter a number between -180 and 180</div>
          }
        </div>
        <div class="form__line">
          <p class="line__label">Connected</p>
          <div formArrayName="connected">
            @for (connect of getFormsControls()['controls']; track $index) {
              <div class="content_input">
                <select
                  id="connected"
                  name="connected"
                  class="line__input"
                  formControlName="{{ $index }}"
                  (change)="changeSelect()"
                >
                  @for (val of data; track val.id) {
                    <option [value]="val.id" [disabled]="checkSelect(val.id)">
                      {{ val.city }}
                    </option>
                  }
                </select>
              </div>
              @if (form.controls.connected.controls[0].value?.length === 0) {
                <div class="start">Please enter a connect</div>
              }
            }
          </div>
        </div>
        <button type="submit">Save</button>
      </form>
    </div>
    <!-- <div class="stations">
      @for (val of data; track val.id) {
        <app-station></app-station>
      }
    </div> -->
  </div>
</div>
