<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <p-autoComplete
    formControlName="from"
    [suggestions]="filteredCities"
    (completeMethod)="filterCities($event)"
    [dropdown]="true"
  />
  @let from = form.get('from');
  @if (from && (from.dirty || from.touched)) {
    @if (from.hasError('required')) {
      <div>
        <small class="p-error">From is required</small>
      </div>
    }
  }
  <p-autoComplete
    formControlName="to"
    [suggestions]="filteredCities"
    (completeMethod)="filterCities($event)"
    [dropdown]="true"
  />
  @let to = form.get('to');
  @if (to && (to.dirty || to.touched)) {
    @if (to.hasError('required')) {
      <div>
        <small class="p-error">To is required</small>
      </div>
    }
  }
  <p-calendar formControlName="date" />
  @let date = form.get('date');
  @if (date && (date.dirty || date.touched)) {
    @if (date.hasError('required')) {
      <div>
        <small class="p-error">Date is required</small>
      </div>
    }
    @if (date.hasError('pastDate')) {
      <div>
        <small class="p-error">Date cannot be in the past</small>
      </div>
    }
    @if (date.valid) {
      <p-calendar
        inputId="calendar-timeonly"
        formControlName="time"
        [timeOnly]="true"
      />
    }
  }
  <p-button label="Submit" type="submit" [disabled]="form.invalid" />
</form>

<div>
  @let trips = fetchTripsService.tripsSignal;
  @if (trips) {
    @for (trip of trips.routes; track $index) {
      <app-single-trip
        [trip]="trip"
        [cityNames]="{ from: trips.from.city, to: trips.to.city }"
      ></app-single-trip>
    }
  }
</div>
